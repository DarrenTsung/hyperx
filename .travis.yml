language: rust
sudo: false
dist: trusty
matrix:
    fast_finish: true
    include:
        - rust: nightly
          env: FEATURES="--features nightly"
        - rust: beta
        - rust: stable
          env: FEATURES="--no-default-features"
        - rust: stable
          env: FEATURES="--features compat"
        - rust: 1.21.0

cache:
    apt: true
    directories:
        - target/debug/deps
        - target/debug/build

script:
  - cargo build $FEATURES
  - 'if [ "$BUILD_ONLY" != "1" ]; then cargo test $FEATURES; fi'

addons:
  apt:
    packages:
      - libcurl4-openssl-dev
      - libelf-dev
      - libdw-dev
      - binutils-dev
      - libiberty-dev
